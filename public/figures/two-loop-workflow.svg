<svg viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg" fill="none">
  <style>
    .box { fill: #FAFAFA; stroke: #E6E8EB; stroke-width: 1.5; }
    .box-accent { fill: rgba(31, 58, 138, 0.06); stroke: #1F3A8A; stroke-width: 1.5; stroke-dasharray: 4 2; }
    .box-highlight { fill: rgba(31, 58, 138, 0.1); stroke: #1F3A8A; stroke-width: 2; }
    .box-dark { fill: #1F3A8A; stroke: #1F3A8A; stroke-width: 1.5; }
    .box-text { font-family: Inter, sans-serif; font-size: 10px; fill: #111111; font-weight: 500; }
    .box-text-light { font-family: Inter, sans-serif; font-size: 10px; fill: #FFFFFF; font-weight: 500; }
    .box-text-sm { font-family: Inter, sans-serif; font-size: 8px; fill: #5F6368; }
    .arrow { stroke: #1F3A8A; stroke-width: 1.5; fill: none; marker-end: url(#arrowhead); }
    .arrow-dashed { stroke: #5F6368; stroke-width: 1; fill: none; stroke-dasharray: 4 3; marker-end: url(#arrowhead-gray); }
    .label { font-family: 'IBM Plex Mono', monospace; font-size: 8px; fill: #1F3A8A; font-weight: 500; }
    .group-label { font-family: 'IBM Plex Mono', monospace; font-size: 9px; fill: #1F3A8A; font-weight: 600; letter-spacing: 0.08em; }
    .muted { font-family: 'IBM Plex Mono', monospace; font-size: 8px; fill: #5F6368; }
    .fig-label { font-family: 'IBM Plex Mono', monospace; font-size: 10px; fill: #5F6368; font-weight: 500; }
  </style>

  <defs>
    <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#1F3A8A"/>
    </marker>
    <marker id="arrowhead-gray" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#5F6368"/>
    </marker>
  </defs>

  <!-- Figure label -->
  <text x="400" y="25" text-anchor="middle" class="fig-label">FIG 1 — TWO-LOOP AGENT WORKFLOW</text>

  <!-- Loop A: Pair Loop -->
  <rect x="30" y="50" width="340" height="200" rx="4" class="box-accent"/>
  <text x="50" y="70" class="group-label">LOOP A: PAIR (INTERACTIVE)</text>

  <rect x="50" y="90" width="90" height="45" rx="3" class="box"/>
  <text x="95" y="110" text-anchor="middle" class="box-text">Define Task</text>
  <text x="95" y="122" text-anchor="middle" class="box-text-sm">constraints</text>

  <rect x="160" y="90" width="90" height="45" rx="3" class="box"/>
  <text x="205" y="110" text-anchor="middle" class="box-text">Working Set</text>
  <text x="205" y="122" text-anchor="middle" class="box-text-sm">1-3 files</text>

  <rect x="270" y="90" width="80" height="45" rx="3" class="box-highlight"/>
  <text x="310" y="110" text-anchor="middle" class="box-text">Call Skills</text>
  <text x="310" y="122" text-anchor="middle" class="box-text-sm">versioned</text>

  <rect x="50" y="160" width="130" height="35" rx="3" class="box"/>
  <text x="115" y="182" text-anchor="middle" class="box-text-sm">Validate (tests/lint/types)</text>

  <rect x="200" y="160" width="150" height="35" rx="3" class="box-dark"/>
  <text x="275" y="182" text-anchor="middle" class="box-text-light">Session State</text>

  <!-- Arrows Loop A -->
  <path d="M 140 112 L 152 112" class="arrow"/>
  <path d="M 250 112 L 262 112" class="arrow"/>
  <path d="M 310 135 L 310 152" class="arrow"/>
  <path d="M 200 177 L 188 177" class="arrow"/>

  <!-- Loop indicator A -->
  <path d="M 95 160 L 95 145 L 50 145 L 50 90 L 42 90" class="arrow-dashed"/>
  <text x="38" y="120" class="muted">iterate</text>

  <!-- Loop B: Agent Loop -->
  <rect x="430" y="50" width="340" height="200" rx="4" class="box-accent"/>
  <text x="450" y="70" class="group-label">LOOP B: AGENT (AUTONOMOUS)</text>

  <rect x="450" y="90" width="100" height="45" rx="3" class="box"/>
  <text x="500" y="110" text-anchor="middle" class="box-text">Agent Contract</text>
  <text x="500" y="122" text-anchor="middle" class="box-text-sm">inputs/deliverables</text>

  <rect x="570" y="90" width="90" height="45" rx="3" class="box-highlight"/>
  <text x="615" y="110" text-anchor="middle" class="box-text">Skill Pipeline</text>
  <text x="615" y="122" text-anchor="middle" class="box-text-sm">RepoMap→Patch</text>

  <rect x="680" y="90" width="70" height="45" rx="3" class="box"/>
  <text x="715" y="110" text-anchor="middle" class="box-text">Bundle</text>
  <text x="715" y="122" text-anchor="middle" class="box-text-sm">patch+tests</text>

  <rect x="450" y="160" width="130" height="35" rx="3" class="box"/>
  <text x="515" y="182" text-anchor="middle" class="box-text-sm">Risk List + Rollback</text>

  <rect x="600" y="160" width="150" height="35" rx="3" class="box-dark"/>
  <text x="675" y="182" text-anchor="middle" class="box-text-light">Review Bundle</text>

  <!-- Arrows Loop B -->
  <path d="M 550 112 L 562 112" class="arrow"/>
  <path d="M 660 112 L 672 112" class="arrow"/>
  <path d="M 715 135 L 715 152 L 758 152" class="arrow"/>
  <path d="M 600 177 L 588 177" class="arrow"/>

  <!-- Converging section -->
  <rect x="30" y="280" width="740" height="130" rx="4" class="box-accent"/>
  <text x="50" y="300" class="group-label">VERIFICATION GATE</text>

  <rect x="50" y="320" width="100" height="40" rx="3" class="box"/>
  <text x="100" y="337" text-anchor="middle" class="box-text">Tests Pass</text>
  <text x="100" y="350" text-anchor="middle" class="box-text-sm">unit + integration</text>

  <rect x="170" y="320" width="100" height="40" rx="3" class="box"/>
  <text x="220" y="337" text-anchor="middle" class="box-text">Lint Pass</text>
  <text x="220" y="350" text-anchor="middle" class="box-text-sm">style + rules</text>

  <rect x="290" y="320" width="100" height="40" rx="3" class="box"/>
  <text x="340" y="337" text-anchor="middle" class="box-text">Types Pass</text>
  <text x="340" y="350" text-anchor="middle" class="box-text-sm">compile check</text>

  <rect x="410" y="320" width="120" height="40" rx="3" class="box-highlight"/>
  <text x="470" y="337" text-anchor="middle" class="box-text">Acceptance</text>
  <text x="470" y="350" text-anchor="middle" class="box-text-sm">criteria met</text>

  <rect x="550" y="320" width="100" height="40" rx="3" class="box"/>
  <text x="600" y="337" text-anchor="middle" class="box-text">Scorecard</text>
  <text x="600" y="350" text-anchor="middle" class="box-text-sm">eval metrics</text>

  <rect x="670" y="320" width="80" height="40" rx="3" class="box-dark"/>
  <text x="710" y="344" text-anchor="middle" class="box-text-light">PR Ready</text>

  <!-- Arrows from loops to verification -->
  <path d="M 200 250 L 200 272" class="arrow"/>
  <path d="M 600 250 L 600 272" class="arrow"/>

  <!-- Arrows in verification -->
  <path d="M 150 340 L 162 340" class="arrow"/>
  <path d="M 270 340 L 282 340" class="arrow"/>
  <path d="M 390 340 L 402 340" class="arrow"/>
  <path d="M 530 340 L 542 340" class="arrow"/>
  <path d="M 650 340 L 662 340" class="arrow"/>

  <!-- Labels -->
  <text x="200" y="265" text-anchor="middle" class="label">artifacts</text>
  <text x="600" y="265" text-anchor="middle" class="label">bundle</text>

  <!-- Footer note -->
  <text x="400" y="430" text-anchor="middle" class="muted">Both loops converge at verification — artifacts are the interface, not conversation</text>
</svg>
